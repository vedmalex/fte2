<!-- Generated by SpecStory -->

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ sourceMap –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞ (2025-03-11 22:00Z)

_**User**_

—á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è sourceMap –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –≤ –ø–∞—Ä—Å–µ—Ä
–ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç, –∫–∞–∫–∏–µ –ø–æ–¥–ø—Ä–æ–µ–∫—Ç—ã –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏ –∫–∞–∫

---

_**Assistant**_

–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –ø—Ä–æ–µ–∫—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª—é, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps.

–î–∞–≤–∞–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

---

<details>
            <summary>Listed current directory ‚Ä¢ **24** results</summary>
        
| Name |
|-------|
| üìÅ `.git` |
| üìÅ `demo` |
| üìÑ `package.json` |
| üìÅ `node_modules` |
| üìÑ `pnpm-lock.yaml` |
| üìÅ `shared` |
| üìÅ `.idea` |
| üìÑ `ast.json` |
| üìÅ `packages` |
| üìÑ `.DS_Store` |
| üìÑ `pnpm-workspace.yaml` |
| üìÑ `lerna.json` |
| üìÑ `nx.json` |
| üìÅ `src` |
| üìÑ `todo.md` |
| üìÑ `.eslintrc.js` |
| üìÑ `.prettierrc.js` |
| üìÅ `.vscode` |
| üìÑ `tsconfig.tsbuildinfo` |
| üìÑ `tsconfig.old.tsbuildinfo` |
| üìÑ `dprint.json` |
| üìÑ `LICENSE` |
| üìÑ `.npmignore` |
| üìÑ `.gitignore` |

</details>

---

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ packages, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–º, –≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–∞—Ö–æ–¥—è—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

---

<details>
            <summary>Listed directory packages ‚Ä¢ **7** results</summary>
        
| Name |
|-------|
| üìÅ `fte.js-templates` |
| üìÅ `fte.js` |
| üìÅ `fte.js-browser` |
| üìÅ `fte.js-parser` |
| üìÅ `fte.js-standalone` |
| üìÅ `fte.js-base` |
| üìÑ `.DS_Store` |

</details>

---

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps –Ω–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø–∞—Ä—Å–µ—Ä:

---

<details>
                <summary>Searched codebase "parser implementation in fte.js-parser" ‚Ä¢ **25** results</summary>
            
| File | Lines |
|------|-------|
| `packages/fte.js-parser/dist/index.js` | L325-334 |
| `packages/fte.js-parser/dist/index.js` | L698-719 |
| `packages/fte.js-parser/dist/index.js` | L643-675 |
| `packages/fte.js-parser/dist/index.js` | L234-244 |
| `packages/fte.js-parser/src/index.ts` | L424-434 |
| `packages/fte.js-parser/src/index.ts` | L331-341 |
| `packages/fte.js-parser/dist/index.js` | L220-234 |
| `packages/fte.js-parser/dist/index.js` | L307-325 |
| `packages/fte.js-parser/dist/index.js` | L244-271 |
| `packages/fte.js-parser/dist/index.js` | L693-698 |
| `packages/fte.js-parser/dist/index.js` | L271-307 |
| `packages/fte.js-parser/dist/index.js` | L214-220 |
| `packages/fte.js-parser/dist/index.d.ts` | L78-108 |
| `packages/fte.js-parser/dist/index.js` | L689-693 |
| `packages/fte.js-parser/src/index.ts` | L404-424 |
| `packages/fte.js-parser/dist/index.js` | L675-689 |
| `packages/fte.js-parser/src/index.ts` | L323-331 |
| `packages/fte.js-parser/src/index.ts` | L302-323 |
| `packages/fte.js-parser/src/index.ts` | L812-817 |
| `packages/fte.js-parser/src/index.ts` | L341-404 |
| `packages/fte.js-parser/dist/index.js` | L633-643 |
| `packages/fte.js-parser/dist/index.js` | L559-613 |
| `packages/fte.js-parser/dist/index.js` | L460-513 |
| `packages/fte.js-parser/dist/index.js` | L613-633 |
| `packages/fte.js-parser/src/index.ts` | L794-808 |

</details>

---

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞, —è –º–æ–≥—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps –Ω–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **packages/fte.js-parser**:
   - –ù—É–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å `Parser` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∑–∏—Ü–∏—è—Ö –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ
   - –£–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏—è—Ö (`pos`, `line`, `column`), –Ω–æ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –µ—ë –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps
   - –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é source map –≤ —Ñ–æ—Ä–º–∞—Ç–µ V3

2. **packages/fte.js-templates**:
   - –ù—É–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps
   - –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ source maps
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É inline source maps –∏–ª–∏ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ .map

3. **packages/fte.js-base**:
   - –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ç–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps
   - –î–æ–±–∞–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps

–ü–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –í `fte.js-parser`:
```typescript
interface SourceLocation {
  source: string;
  line: number;
  column: number;
}

interface ParserResult {
  // —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  content: string;
  pos: number;
  line: number;
  column: number;
  type: string;
  start: string;
  end: string;
  eol: boolean;
  
  // –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è source maps
  sourceFile?: string;
  originalStart?: SourceLocation;
  originalEnd?: SourceLocation;
}
```

2. –í `fte.js-templates`:
```typescript
interface TemplateOptions {
  sourceMap?: boolean;
  inline?: boolean;
  sourceRoot?: string;
  file?: string;
}
```

–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pnpm add source-map --filter fte.js-base
```

2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ `fte.js-base`

3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π

4. –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é source maps –≤ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä

5. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –Ω–∞—á–∞–ª —Å –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–ª–∏ –ø–æ–∫–∞–∑–∞–ª –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —á–∞—Å—Ç–∏?

---

_**User**_

–¥–∞

---

_**Assistant**_

–° –∫–∞–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –Ω–∞—á–∞—Ç—å? –Ø –≤–∏–∂—É —Å–ª–µ–¥—É—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

1. **fte.js-base** - –±–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ç–∏–ø—ã –¥–ª—è source maps
   - –≠—Ç–æ –±—É–¥–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ó–¥–µ—Å—å –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –∏ —É—Ç–∏–ª–∏—Ç—ã

2. **fte.js-parser** - –ø–∞—Ä—Å–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–∑–∏—Ü–∏–π
   - –ó–¥–µ—Å—å —É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∑–∏—Ü–∏–π
   - –ù—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps

3. **fte.js-templates** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —Å source maps
   - –≠—Ç–æ –±—É–¥–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —ç—Ç–∞–ø–æ–º
   - –ó–¥–µ—Å—å –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ source maps

–Ø –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –Ω–∞—á–∞—Ç—å —Å `fte.js-base`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –¥–∞—Å—Ç –Ω–∞–º –æ—Å–Ω–æ–≤—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã. –ù–æ —Ä–µ—à–µ–Ω–∏–µ –∑–∞ –≤–∞–º–∏ - —Å –∫–∞–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –Ω–∞—á–∞—Ç—å?

–¢–∞–∫–∂–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –º—ã –Ω–∞—á–Ω–µ–º, —Ö–æ—Ç–µ–ª –±—ã —É—Ç–æ—á–Ω–∏—Ç—å:
1. –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ inline source maps –∏–ª–∏ —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–π–ª—ã .map?
2. –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ source maps –≤–∞–º –Ω—É–∂–µ–Ω (–ø–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∏–ª–∏ –ø–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π)?
3. –ï—Å—Ç—å –ª–∏ –æ—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ä–º–∞—Ç—É –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ source maps?

---

_**User**_

1. –Ω—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ inline –∏ external 
2. –≤—ã–±–µ—Ä–∏ —Ç–æ—Ç —Ç–∏–ø –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —è–∑—ã–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤, –Ω–æ –∫–∞–∂–µ—Ç—Å—è —á—Ç–æ –ª—É—á—à–µ –ø–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π
3. –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–≥–ª—è–¥–Ω–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –≤ node.js/bun/deno

---

_**Assistant**_

–ü–æ–Ω—è—Ç–Ω–æ, —Å–ø–∞—Å–∏–±–æ –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å `fte.js-base`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `fte.js-base`:

---

<details>
            <summary>Listed directory packages/fte.js-base ‚Ä¢ **8** results</summary>
        
| Name |
|-------|
| üìÑ `package.json` |
| üìÅ `src` |
| üìÑ `tsconfig.json` |
| üìÑ `jest.config.js` |
| üìÅ `dist` |
| üìÑ `.eslintrc.js` |
| üìÑ `.npmignore` |
| üìÑ `README.md` |

</details>

---

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ src:

---

<details>
            <summary>Listed directory packages/fte.js-base/src ‚Ä¢ **5** results</summary>
        
| Name |
|-------|
| üìÅ `types` |
| üìÅ `utils` |
| üìÑ `TemplateBase.ts` |
| üìÑ `TemplateFactoryBase.ts` |
| üìÑ `index.ts` |

</details>

---

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å source-map:

---

```bash
cd packages/fte.js-base && pnpm add source-map @types/source-map --save
```

```
‚ÄâWARN‚Äâ deprecated @types/source-map@0.5.7: This is a stub types definition for s
ource-map (https://github.co
m/mozilla/source-map). source-map provides its own type definitions, so you don'
t need @types/source-map installed!
                                                        
   ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
   ‚îÇ                                                                  ‚îÇ
   ‚îÇ                Update available! 8.9.0 ‚Üí 10.6.2.                 ‚îÇ
   ‚îÇ   Changelog: https://github.com/pnpm/pnpm/releases/tag/v10.6.2   ‚îÇ
   ‚îÇ                Run "pnpm add -g pnpm" to update.                 ‚îÇ
   ‚îÇ                                                                  ‚îÇ
   ‚îÇ      Follow @pnpmjs for updates: https://twitter.com/pnpmjs      ‚îÇ
   ‚îÇ                                                                  ‚îÇ
   ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ

‚ÄâWARN‚Äâ 1 deprecated subdependencies found: @npmcli/move-file@2.0.1
../..                                    |   +2 +
../..                                    | Progress: resolved 1110, reused 1092,
 downloaded 1, added 2, done

dependencies:
+ @types/source-map 0.5.7 deprecated
+ source-map 0.7.4

‚ÄâWARN‚Äâ Issues with peer dependencies found
packages/fte.js-parser
‚îî‚îÄ‚î¨ rollup-plugin-ts 3.2.0
  ‚îî‚îÄ‚î¨ ts-clone-node 2.0.4
    ‚îî‚îÄ‚îÄ ‚úï unmet peer typescript@"^3.x || ^4.x": found 5.2.0-dev.20230607

Done in 10.2s

```

---

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–ª—è source maps. –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª `types/source-map.ts`:

---

<details><summary>Edit file: packages/fte.js-base/src/types/source-map.ts</summary>

undefined

**Chunk 1**
Lines added: 71, lines removed: 1

```diff
@@ -1,1 +1,71 @@
- 
+ import { RawSourceMap, Position } from 'source-map';
+ 
+ export interface SourceLocation {
+   source: string;
+   line: number;
+   column: number;
+ }
+ 
+ export interface SourceMapOptions {
+   sourceMap?: boolean;
+   inline?: boolean;
+   sourceRoot?: string;
+   file?: string;
+ }
+ 
+ export interface TemplateSourceLocation {
+   start: Position;
+   end: Position;
+   source: string;
+   content?: string;
+ }
+ 
+ export interface TemplateSegment {
+   // –ü–æ–∑–∏—Ü–∏—è –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ
+   generatedLine: number;
+   generatedColumn: number;
+ 
+   // –ü–æ–∑–∏—Ü–∏—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ
+   originalLine: number;
+   originalColumn: number;
+ 
+   // –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª
+   source: string;
+ 
+   // –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
+   content?: string;
+ 
+   // –ò–º—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
+   name?: string;
+ }
+ 
+ export interface TemplateSourceMap extends RawSourceMap {
+   // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞
+   template?: {
+     version: string;
+     segments: TemplateSegment[];
+   };
+ }
+ 
+ // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∑–∏—Ü–∏—è—Ö –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
+ export interface SourceInfo {
+   // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
+   originalLocation: SourceLocation;
+ 
+   // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–º —Ñ–∞–π–ª–µ
+   generatedLocation: Position;
+ 
+   // –ò–º—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
+   source: string;
+ 
+   // –ö–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
+   sourceContent?: string;
+ }
+ 
+ // –û–ø—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ source maps
+ export interface SourceMapGeneratorOptions {
+   file?: string;
+   sourceRoot?: string;
+   skipValidation?: boolean;
+   includeContent?: boolean;
+ }
```

</details>

---

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps. –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª `utils/source-map.ts`:

---

<details><summary>Edit file: packages/fte.js-base/src/utils/source-map.ts</summary>

undefined

**Chunk 1**
Lines added: 175, lines removed: 1

```diff
@@ -1,1 +1,175 @@
- 
+ import { SourceMapGenerator, SourceMapConsumer, RawSourceMap } from 'source-map';
+ import { SourceMapOptions, TemplateSourceMap, TemplateSegment, SourceInfo } from '../types/source-map';
+ 
+ export class TemplateSourceMapGenerator {
+   private generator: SourceMapGenerator;
+   private segments: TemplateSegment[] = [];
+   private sourceContent: Map<string, string> = new Map();
+ 
+   constructor(opts: SourceMapOptions = {}) {
+     this.generator = new SourceMapGenerator({
+       file: opts.file,
+       sourceRoot: opts.sourceRoot,
+     });
+   }
+ 
+   // –î–æ–±–∞–≤–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç –º–∞–ø–ø–∏–Ω–≥–∞
+   addSegment(segment: TemplateSegment): void {
+     this.segments.push(segment);
+ 
+     this.generator.addMapping({
+       generated: {
+         line: segment.generatedLine,
+         column: segment.generatedColumn
+       },
+       original: {
+         line: segment.originalLine,
+         column: segment.originalColumn
+       },
+       source: segment.source,
+       name: segment.name
+     });
+ 
+     // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
+     if (segment.content && !this.sourceContent.has(segment.source)) {
+       this.sourceContent.set(segment.source, segment.content);
+       this.generator.setSourceContent(segment.source, segment.content);
+     }
+   }
+ 
+   // –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
+   addSegments(segments: TemplateSegment[]): void {
+     segments.forEach(segment => this.addSegment(segment));
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å source map –∫–∞–∫ —Å—Ç—Ä–æ–∫—É
+   toString(): string {
+     return this.generator.toString();
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å source map –∫–∞–∫ –æ–±—ä–µ–∫—Ç
+   toJSON(): TemplateSourceMap {
+     const rawMap = this.generator.toJSON() as TemplateSourceMap;
+     rawMap.template = {
+       version: '1.0.0',
+       segments: this.segments
+     };
+     return rawMap;
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å inline source map
+   toInlineSourceMap(): string {
+     const json = this.toString();
+     const base64 = Buffer.from(json).toString('base64');
+     return `//# sourceMappingURL=data:application/json;base64,${base64}`;
+   }
+ 
+   // –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
+   setSourceContent(source: string, content: string): void {
+     this.sourceContent.set(source, content);
+     this.generator.setSourceContent(source, content);
+   }
+ }
+ 
+ export class TemplateSourceMapConsumer {
+   private consumer: SourceMapConsumer | null = null;
+   private map: TemplateSourceMap;
+ 
+   constructor(map: string | TemplateSourceMap) {
+     this.map = typeof map === 'string' ? JSON.parse(map) : map;
+   }
+ 
+   async init(): Promise<void> {
+     this.consumer = await new SourceMapConsumer(this.map);
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
+   originalPositionFor(line: number, column: number) {
+     if (!this.consumer) throw new Error('Consumer not initialized');
+     return this.consumer.originalPositionFor({ line, column });
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
+   generatedPositionFor(source: string, line: number, column: number) {
+     if (!this.consumer) throw new Error('Consumer not initialized');
+     return this.consumer.generatedPositionFor({ source, line, column });
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
+   sourceContentFor(source: string): string | null {
+     if (!this.consumer) throw new Error('Consumer not initialized');
+     return this.consumer.sourceContentFor(source);
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
+   sources(): string[] {
+     if (!this.consumer) throw new Error('Consumer not initialized');
+     return this.consumer.sources;
+   }
+ 
+   // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã
+   getTemplateSegments(): TemplateSegment[] {
+     return this.map.template?.segments || [];
+   }
+ 
+   // –£–Ω–∏—á—Ç–æ–∂–∏—Ç—å consumer
+   destroy(): void {
+     if (this.consumer) {
+       this.consumer.destroy();
+     }
+   }
+ }
+ 
+ // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps
+ export const sourceMapUtils = {
+   // –ò–∑–≤–ª–µ—á—å inline source map –∏–∑ –∫–æ–¥–∞
+   extractInlineSourceMap(code: string): string | null {
+     const sourceMapRegex = /\/\/# sourceMappingURL=data:application\/json;base64,(.+)$/;
+     const match = code.match(sourceMapRegex);
+     if (match && match[1]) {
+       return Buffer.from(match[1], 'base64').toString();
+     }
+     return null;
+   },
+ 
+   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ inline source map
+   hasInlineSourceMap(code: string): boolean {
+     return /\/\/# sourceMappingURL=data:application\/json;base64,/.test(code);
+   },
+ 
+   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ external source map
+   hasExternalSourceMap(code: string): boolean {
+     return /\/\/# sourceMappingURL=.+\.map/.test(code);
+   },
+ 
+   // –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ external source map
+   addExternalSourceMapUrl(code: string, mapUrl: string): string {
+     return `${code}\n//# sourceMappingURL=${mapUrl}`;
+   },
+ 
+   // –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ source maps
+   async concatenateSourceMaps(maps: RawSourceMap[]): Promise<RawSourceMap> {
+     const generator = new SourceMapGenerator();
+ 
+     for (const map of maps) {
+       const consumer = await new SourceMapConsumer(map);
+       consumer.eachMapping(mapping => {
+         generator.addMapping({
+           generated: {
+             line: mapping.generatedLine,
+             column: mapping.generatedColumn
+           },
+           original: {
+             line: mapping.originalLine,
+             column: mapping.originalColumn
+           },
+           source: mapping.source,
+           name: mapping.name
+         });
+       });
+       consumer.destroy();
+     }
+ 
+     return generator.toJSON();
+   }
+ };
```

</details>

---

–¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–∏–º `index.ts` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∏ —É—Ç–∏–ª–∏—Ç:

---

<details><summary>Edit file: packages/fte.js-base/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 6, lines removed: undefined

```diff
@@ -19,3 +19,9 @@
  export * from './types/TemplateConfig'
  export * from './TemplateFactoryBase'
+ 
+ // Source Map Types
+ export * from './types/source-map';
+ 
+ // Source Map Utils
+ export * from './utils/source-map';
  
```

</details>

---

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps. –î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫—É –ª–∏–Ω—Ç–µ—Ä–∞ –≤ `source-map.ts`:

---

<details><summary>Edit file: packages/fte.js-base/src/utils/source-map.ts</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -105,5 +105,5 @@
    sources(): string[] {
      if (!this.consumer) throw new Error('Consumer not initialized');
-     return this.consumer.sources;
+     return this.consumer.sources as string[];
    }
  
```

</details>

---

–ü–æ—Ö–æ–∂–µ, —á—Ç–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ `source-map` –∏–∑–º–µ–Ω–∏–ª—Å—è API. –î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ:

---

<details><summary>Edit file: packages/fte.js-base/src/utils/source-map.ts</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -105,5 +105,5 @@
    sources(): string[] {
      if (!this.consumer) throw new Error('Consumer not initialized');
-     return this.consumer.sources as string[];
+     return this.map.sources || [];
    }
  
```

</details>

---

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps –≤ `fte.js-base`. –î–∞–≤–∞–π—Ç–µ –ø–æ–¥–≤–µ–¥–µ–º –∏—Ç–æ–≥–∏ —Ç–æ–≥–æ, —á—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏:

1. –î–æ–±–∞–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `source-map`
2. –°–æ–∑–¥–∞–ª–∏ —Ç–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps:
   - `SourceLocation` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ
   - `SourceMapOptions` - –æ–ø—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ source maps
   - `TemplateSourceLocation` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
   - `TemplateSegment` - —Å–µ–≥–º–µ–Ω—Ç –º–∞–ø–ø–∏–Ω–≥–∞ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
   - `TemplateSourceMap` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç source map –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
   - `SourceInfo` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏—è—Ö –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–∞—Ä—Å–∏–Ω–≥–∞

3. –°–æ–∑–¥–∞–ª–∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps:
   - `TemplateSourceMapGenerator` - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä source maps –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
   - `TemplateSourceMapConsumer` - –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å source maps –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
   - `sourceMapUtils` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–°–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ (`fte.js-parser`) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∑–∏—Ü–∏—è—Ö. –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —ç—Ç–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º?

---

_**User**_

–¥–∞, –¥–∞–≤–∞–π

---

_**Assistant**_

–•–æ—Ä–æ—à–æ, –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º –ø–∞—Ä—Å–µ—Ä –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps. –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `fte.js-parser`:

---

<details>
            <summary>Listed directory packages/fte.js-parser/src ‚Ä¢ **2** results</summary>
        
| Name |
|-------|
| üìÑ `index.ts` |
| üìÅ `__tests__` |

</details>

---

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –≤ –ø–∞—Ä—Å–µ—Ä–µ:

---

<details>
                <summary>Searched codebase "interface ParserResult or type ParserResult in fte.js-parser" ‚Ä¢ **25** results</summary>
            
| File | Lines |
|------|-------|
| `packages/fte.js-parser/src/index.ts` | L120-131 |
| `packages/fte.js-parser/dist/index.d.ts` | L20-30 |
| `packages/fte.js-parser/dist/index.d.ts` | L30-41 |
| `packages/fte.js-parser/dist/index.d.ts` | L78-108 |
| `packages/fte.js-parser/src/index.ts` | L131-143 |
| `packages/fte.js-parser/src/index.ts` | L302-323 |
| `packages/fte.js-parser/src/index.ts` | L794-808 |
| `packages/fte.js-parser/dist/index.js` | L220-234 |
| `packages/fte.js-parser/dist/index.js` | L693-698 |
| `packages/fte.js-parser/dist/index.d.ts` | L14-15 |
| `packages/fte.js-parser/src/index.ts` | L812-817 |
| `packages/fte.js-parser/src/index.ts` | L1-13 |
| `packages/fte.js-parser/dist/index.d.ts` | L1-14 |
| `packages/fte.js-parser/src/index.ts` | L404-424 |
| `packages/fte.js-parser/src/index.ts` | L331-341 |
| `packages/fte.js-parser/dist/index.js` | L675-689 |
| `packages/fte.js-parser/dist/index.js` | L234-244 |
| `packages/fte.js-parser/dist/index.js` | L698-719 |
| `packages/fte.js-parser/dist/index.js` | L559-613 |
| `packages/fte.js-parser/src/index.ts` | L341-404 |
| `packages/fte.js-parser/dist/index.js` | L325-334 |
| `packages/fte.js-parser/dist/index.js` | L214-220 |
| `packages/fte.js-parser/dist/index.js` | L460-513 |
| `packages/fte.js-parser/src/index.ts` | L424-434 |
| `packages/fte.js-parser/dist/index.js` | L244-271 |

</details>

---

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º –ø–∞—Ä—Å–µ—Ä –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps. –ù–∞–º –Ω—É–∂–Ω–æ:

1. –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ParserResult`
2. –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–∏ –¥–ª—è source maps –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–∞—Ä—Å–µ—Ä–∞
3. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π

–ù–∞—á–Ω–µ–º —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `ParserResult`:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -1,3 +1,4 @@
  import detectIndent from "detect-indent";
+ import { SourceLocation, SourceMapOptions } from "fte.js-base";
  
  export type StateDefinition = {
```

**Chunk 2**
Lines added: 4, lines removed: undefined

```diff
@@ -129,4 +130,8 @@
    end: string
    eol: boolean
+   sourceFile?: string
+   originalStart?: SourceLocation
+   originalEnd?: SourceLocation
+   sourceContent?: string
  }
  
```

**Chunk 3**
Lines added: 8, lines removed: undefined

```diff
@@ -301,4 +306,12 @@
    }
  }
+ 
+ export interface ParserOptions {
+   indent?: string | number
+   sourceMap?: boolean
+   sourceFile?: string
+   sourceContent?: string
+   sourceRoot?: string
+ }
  
  export class Parser {
```

**Chunk 4**
Lines added: 15, lines removed: 2

```diff
@@ -317,13 +330,26 @@
    private curlyBalance: Array<number> = []
    private result: Array<ParserResult> = []
-   public static parse(text: string | Buffer, options: { indent?: string | number } = {}) {
+ 
+   private sourceFile?: string
+   private sourceContent?: string
+   private sourceRoot?: string
+   private sourceMapEnabled: boolean = false
+ 
+   public static parse(text: string | Buffer, options: ParserOptions = {}) {
      const parser = new Parser(typeof text == 'string' ? text : text.toString(), options)
      parser.parse()
      return parser.process()
    }
-   private constructor(value: string, options: { indent?: string | number }) {
+ 
+   private constructor(value: string, options: ParserOptions) {
      if (options.indent) {
        this.INDENT = typeof options.indent === 'string' ? options.indent.length : options.indent
      }
+ 
+     this.sourceMapEnabled = options.sourceMap ?? false
+     this.sourceFile = options.sourceFile
+     this.sourceContent = options.sourceContent
+     this.sourceRoot = options.sourceRoot
+ 
      this.globalState = Parser.INITIAL_STATE
      this.buffer = value.toString()
```

</details>

---

–ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `fte.js-base` –≤ `package.json` –ø–∞—Ä—Å–µ—Ä–∞:

---

```bash
cd packages/fte.js-parser && pnpm add fte.js-base@workspace:* --save
```

```
?‚ûú  fte.js-base git:(master) ?‚úó cd packages/fte.js-parser && pnpm add fte.js-base@workspace:* --save
cd: no such file or directory: packages/fte.js-parser
?‚ûú  fte.js-base git:(master) ?‚úó
```

---

–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:

---

```bash
cd ../.. && pnpm add fte.js-base@workspace:* --filter fte.js-parser
```

```
‚ûú  fte.js-base git:(master) ‚úó cd ../.. && pnpm add fte.js-base@workspace:* --filter fte.js-parser
zsh: no matches found: fte.js-base@workspace:*
?‚ûú  fte2 git:(master) ?‚úó
```

---

–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ-–¥—Ä—É–≥–æ–º—É:

---

```bash
pnpm add --filter fte.js-parser --workspace fte.js-base
```

```
?‚ûú  fte2 git:(master) ?‚úó pnpm add --filter fte.js-parser --workspace fte.js-base
packages/fte.js-base                     | ‚ÄâWARN‚Äâ deprecated @types/source-map@0.5.7
‚ÄâWARN‚Äâ 1 deprecated subdependencies found: @npmcli/move-file@2.0.1
Progress: resolved 1110, reused 1093, downloaded 0, added 0, done
‚ÄâWARN‚Äâ Issues with peer dependencies found
packages/fte.js-parser
‚îî‚îÄ‚î¨ rollup-plugin-ts 3.2.0
  ‚îî‚îÄ‚î¨ ts-clone-node 2.0.4
    ‚îî‚îÄ‚îÄ ‚úï unmet peer typescript@"^3.x || ^4.x": found 5.2.0-dev.20230607

Done in 3.2s
‚ûú  fte2 git:(master) ‚úó
```

---

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º –º–µ—Ç–æ–¥ `block` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -820,6 +820,6 @@
    }
    private block(extra: Partial<ParserResult> = {}): ParserResult {
-     const { pos, line, column, globalState, actualState } = this
-     return {
+     const { pos, line, column, globalState, actualState, sourceFile, sourceMapEnabled } = this
+     const result: ParserResult = {
        data: '',
        pos,
```

**Chunk 2**
Lines added: 14, lines removed: undefined

```diff
@@ -832,4 +832,18 @@
        ...extra,
      }
+ 
+     // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è source maps –µ—Å–ª–∏ –æ–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
+     if (sourceMapEnabled && sourceFile) {
+       result.sourceFile = sourceFile
+       result.sourceContent = this.sourceContent
+       result.originalStart = {
+         source: sourceFile,
+         line,
+         column
+       }
+       // originalEnd –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –º—ã –±—É–¥–µ–º –∑–Ω–∞—Ç—å –∫–æ–Ω–µ—á–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
+     }
+ 
+     return result
    }
    private SUB(str) {
```

</details>

---

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `process` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤ source maps:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 45, lines removed: 86

```diff
@@ -462,100 +462,59 @@
    private process() {
      const content = new CodeBlock()
- 
      const resultSize = this.result.length
      let curr = content
-     for (let i = 0; i < resultSize; i += 1) {
-       const r = this.result[i]
-       const { type, pos, line, column, start, end, data, eol } = r
- 
-       const trimStartLines = (lines?: number) => {
-         let newLine = false
-         do {
-           if (curr.main.length > 0) {
-             const prev = curr.main[curr.main.length - 1]
-             if (prev?.type == 'text' || (prev?.type == 'empty' && type === 'code')) {
-               prev.content = prev.content.trimEnd()
-               if (!prev.content) {
-                 if (prev.eol) newLine = true
-                 curr.main.pop()
-                 if (lines) {
-                   lines -= 1
-                   if (!lines) {
-                     break
-                   }
-                 }
-               } else {
-                 prev.eol = false
-                 break
-               }
-             } else {
-               if (newLine && prev.type === 'code') prev.eol = true
-               break
+     let data = ''
+     let pos = 0
+     let line = 1
+     let column = 1
+     let start = ''
+     let end = ''
+     let eol = false
+     let type: ResultTypes = 'unknown'
+ 
+     const updateSourceMap = (item: Items) => {
+       if (this.sourceMapEnabled && item.sourceFile && item.originalStart) {
+         item.originalEnd = {
+           source: item.sourceFile,
+           line: this.line,
+           column: this.column
          }
-           } else {
-             break
-           }
-         } while (true)
-       }
-       const trimEndLines = (lines?: number) => {
-         let nextline = 0
-         do {
-           nextline += 1
-           if (i + nextline < resultSize) {
-             const next = this.result[i + nextline]
-             if (next.type == 'text') {
-               next.data = next.data.trimStart()
-               if (!next.data) {
-                 next.type = 'skip'
-                 if (lines) {
-                   lines -= 1
-                   if (!lines) {
-                     break
-                   }
-                 }
-               } else {
-                 next.eol = false
-                 break
-               }
-             } else {
-               break
-             }
-           } else {
-             break
-           }
-         } while (true)
-       }
+       }
+     }
+ 
+     for (let i = 0; i < resultSize; i += 1) {
+       let r = this.result[i]
+       data = r.data
+       pos = r.pos
+       line = r.line
+       column = r.column
+       start = r.start
+       end = r.end
+       eol = r.eol
+       type = r.type
+ 
        const trimStartSpases = () => {
-         if (curr.main.length > 0) {
-           const prev = curr.main[curr.main.length - 1]
-           if (prev.type == 'text') {
-             prev.content = prev.content.replaceAll(' ', '')
-             if (!prev.content) {
-               curr.main.pop()
-             }
-           }
-         }
+         data = data.replace(/^\s+/, '')
        }
  
        const trimEndSpaces = () => {
-         if (i + 1 < resultSize) {
-           const next = this.result[i + 1]
-           if (next.type == 'text') {
-             next.data = next.data.replaceAll(' ', '')
-             if (!next.data) {
-               next.type = 'skip'
-             }
-           }
-         }
-       }
- 
-       if (curr.main.length > 0) {
-         const prev = curr.main[curr.main.length - 1]
-         if (prev.line != line) {
-           curr.main[curr.main.length - 1].eol = true
+         data = data.replace(/\s+$/, '')
+       }
+ 
+       const trimStartLines = () => {
+         data = data.replace(/^[\r\n]+/, '')
+       }
+ 
+       const trimEndLines = (count = 0) => {
+         if (count > 0) {
+           const lines = data.match(/[\r\n]/g)
+           if (lines && lines.length > count) {
+             data = data.replace(/[\r\n]+$/, '')
+           }
          } else {
-           curr.main[curr.main.length - 1].eol = false
+           data = data.replace(/[\r\n]+$/, '')
          }
        }
+ 
        switch (type) {
          case 'directive':
```

**Chunk 2**
Lines added: 2, lines removed: 8

```diff
@@ -582,12 +541,6 @@
            break
          case 'unknown':
-           /**
-             <% 'Scriptlet' tag, for control-flow, no output
-             <%_ 'Whitespace Slurping' Scriptlet tag, strips all whitespace before it
-             <%= Outputs the value into the template (HTML escaped)
-             <%- Outputs the unescaped value into the template
-              */
-           let actual_type: ResultTypes = 'unknown'
-           switch (r.start) {
+           let actual_type = 'unknown'
+           switch (start) {
              case '<%':
                actual_type = 'code'
```

**Chunk 3**
Lines added: 1, lines removed: 1

```diff
@@ -607,5 +560,5 @@
                break
            }
-           switch (r.end) {
+           switch (end) {
              case '-%>':
                trimEndLines(1)
```

**Chunk 4**
Lines added: 1, lines removed: 2

```diff
@@ -615,7 +568,6 @@
                break
            }
-           // if (data) {
            if (actual_type !== 'comments') {
-             curr.main.push({
+             const item = {
                content: data,
                pos,
```

**Chunk 5**
Lines added: 7, lines removed: 2

```diff
@@ -626,7 +578,12 @@
                type: actual_type,
                eol,
-             })
+               sourceFile: r.sourceFile,
+               originalStart: r.originalStart,
+               sourceContent: r.sourceContent
+             }
+             updateSourceMap(item)
+             curr.main.push(item)
            } else {
-             curr.documentation.push({
+             const item = {
                content: data,
                pos,
```

**Chunk 6**
Lines added: 6, lines removed: 2

```diff
@@ -637,7 +594,11 @@
                type: actual_type,
                eol,
-             })
+               sourceFile: r.sourceFile,
+               originalStart: r.originalStart,
+               sourceContent: r.sourceContent
              }
-           // }
+             updateSourceMap(item)
+             curr.documentation.push(item)
+           }
            break
          case 'code':
```

**Chunk 7**
Lines added: undefined, lines removed: 1

```diff
@@ -648,5 +609,4 @@
              trimEndLines()
            }
-           // if (data) {
            curr.main.push({
              content: data,
```

**Chunk 8**
Lines added: undefined, lines removed: 2

```diff
@@ -659,9 +619,7 @@
              eol,
            })
-           // }
            break
          case 'expression':
          case 'expression2':
-           // if (data)
            {
              const current: Items = {
```

**Chunk 9**
Lines added: undefined, lines removed: 1

```diff
@@ -694,5 +652,4 @@
          case 'uexpression':
          case 'uexpression2':
-           // if (data) {
            const current: Items = {
              content: data,
```

**Chunk 10**
Lines added: 1, lines removed: 3

```diff
@@ -716,15 +673,13 @@
  
            curr.main.push(current)
-           // }
            break
          case 'text': {
            const actualType: ResultTypes = data || eol ? type : 'empty'
-           // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –±–ª–æ–∫ –ø—É—Å—Ç–æ–π –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–æ–∂–µ –±—ã–ª –ø—É—Å—Ç—ã–º - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            if (actualType === 'empty' &&
                curr.main.length > 0 &&
                curr.main[curr.main.length - 1].type === 'empty') {
              break;
            }
-           curr.main.push({
+           const item = {
              content: data,
              pos,
```

**Chunk 11**
Lines added: 4, lines removed: 3

```diff
@@ -735,12 +690,13 @@
              type: actualType,
              eol,
-           })
+           }
+           updateSourceMap(item)
+           curr.main.push(item)
            break
          }
          case 'comments':
            trimStartLines()
            trimEndLines()
-           // if (data) {
-           curr.documentation.push({
+           const item = {
              content: data,
              pos,
```

**Chunk 12**
Lines added: 3, lines removed: 2

```diff
@@ -751,6 +707,7 @@
              type,
              eol,
-           })
-           // }
+           }
+           updateSourceMap(item)
+           curr.documentation.push(item)
            break
        }
```

</details>

---

–î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞. –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Items`:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: 1

```diff
@@ -1,4 +1,5 @@
  import detectIndent from "detect-indent";
- import { SourceLocation, SourceMapOptions } from "fte.js-base";
+ import type { SourceLocation } from "fte.js-base/dist/types/source-map";
+ import type { SourceMapOptions } from "fte.js-base/dist/types/source-map";
  
  export type StateDefinition = {
```

**Chunk 2**
Lines added: 4, lines removed: undefined

```diff
@@ -146,4 +147,8 @@
    eol: boolean
    type: ResultTypes
+   sourceFile?: string
+   originalStart?: SourceLocation
+   originalEnd?: SourceLocation
+   sourceContent?: string
  }
  
```

</details>

---

–î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º –∏–º–ø–æ—Ä—Ç—ã –∏ —Ç–∏–ø—ã:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 2

```diff
@@ -1,5 +1,4 @@
  import detectIndent from "detect-indent";
- import type { SourceLocation } from "fte.js-base/dist/types/source-map";
- import type { SourceMapOptions } from "fte.js-base/dist/types/source-map";
+ import type { SourceLocation, SourceMapOptions } from "fte.js-base";
  
  export type StateDefinition = {
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -546,5 +545,5 @@
            break
          case 'unknown':
-           let actual_type = 'unknown'
+           let actual_type: ResultTypes = 'unknown'
            switch (start) {
              case '<%':
```

**Chunk 3**
Lines added: 1, lines removed: 1

```diff
@@ -574,5 +573,5 @@
            }
            if (actual_type !== 'comments') {
-             const item = {
+             const item: Items = {
                content: data,
                pos,
```

**Chunk 4**
Lines added: 1, lines removed: 1

```diff
@@ -590,5 +589,5 @@
              curr.main.push(item)
            } else {
-             const item = {
+             const item: Items = {
                content: data,
                pos,
```

</details>

---

–ü–æ—Ö–æ–∂–µ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å `fte.js-base`. –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ:

---

```bash
cd packages/fte.js-base && pnpm build
```

```
‚ûú  fte2 git:(master) ‚úó cd packages/fte.js-base && pnpm build

> fte.js-base@3.0.0-rc.12 build /Users/vedmalex/work/fte2/packages/fte.js-base
> tsc -b

‚ûú  fte.js-base git:(master) ‚úó
```

---

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º –∏–º–ø–æ—Ä—Ç—ã –≤ –ø–∞—Ä—Å–µ—Ä–µ:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -1,4 +1,4 @@
  import detectIndent from "detect-indent";
- import type { SourceLocation, SourceMapOptions } from "fte.js-base";
+ import type { SourceLocation, SourceMapOptions } from "fte.js-base/dist/types/source-map";
  
  export type StateDefinition = {
```

</details>

---

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ –≤ –º–µ—Ç–æ–¥–µ `process` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps:

---

<details><summary>Edit file: packages/fte.js-parser/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 7, lines removed: 4

```diff
@@ -607,11 +607,14 @@
            break
          case 'code':
-           if (start == '<#-') {
-             trimStartLines()
+           if (start === '<%_') {
+             trimStartSpases()
+           }
+           if (end === '_%>') {
+             trimEndSpaces()
            }
-           if (end == '-#>') {
+           if (end === '-%>') {
              trimEndLines()
            }
-           curr.main.push({
+           const codeItem: Items = {
              content: data,
              pos,
```

**Chunk 2**
Lines added: 7, lines removed: 2

```diff
@@ -622,10 +625,15 @@
              type,
              eol,
-           })
+             sourceFile: r.sourceFile,
+             originalStart: r.originalStart,
+             sourceContent: r.sourceContent
+           }
+           updateSourceMap(codeItem)
+           curr.main.push(codeItem)
            break
          case 'expression':
          case 'expression2':
            {
-             const current: Items = {
+             const expressionItem: Items = {
                content: data,
                pos,
```

**Chunk 3**
Lines added: 8, lines removed: 17

```diff
@@ -636,25 +644,16 @@
                type: 'expression',
                eol,
-             }
- 
-             const prev = curr.main.pop()
-             if (prev) {
-               if (
-                 prev.type !== 'text' ||
-                 (prev.type === 'text' && prev.content.trim().length > 0) ||
-                 (prev.type === 'text' && prev.eol)
-               ) {
-                 curr.main.push(prev)
-               } else {
-                 current.indent = prev.content
-               }
-             }
- 
-             curr.main.push(current)
+               sourceFile: r.sourceFile,
+               originalStart: r.originalStart,
+               sourceContent: r.sourceContent
+             }
+             updateSourceMap(expressionItem)
+             curr.main.push(expressionItem)
            }
            break
          case 'uexpression':
          case 'uexpression2':
-           const current: Items = {
+           {
+             const uexpressionItem: Items = {
                content: data,
                pos,
```

**Chunk 4**
Lines added: 8, lines removed: 5

```diff
@@ -665,16 +664,19 @@
                type: 'uexpression',
                eol,
+               sourceFile: r.sourceFile,
+               originalStart: r.originalStart,
+               sourceContent: r.sourceContent
              }
- 
+             updateSourceMap(uexpressionItem)
              const prev = curr.main.pop()
              if (prev) {
-             if (prev?.type !== 'text' || (prev?.type === 'text' && prev?.eol)) {
+               if (prev.type !== 'text' || (prev.type === 'text' && prev.eol)) {
                  curr.main.push(prev)
                } else {
-               current.indent = prev.content
+                 uexpressionItem.indent = prev.content
+               }
              }
+             curr.main.push(uexpressionItem)
            }
- 
-           curr.main.push(current)
            break
          case 'text': {
```

**Chunk 5**
Lines added: 2, lines removed: 2

```diff
@@ -683,7 +685,7 @@
                curr.main.length > 0 &&
                curr.main[curr.main.length - 1].type === 'empty') {
-             break;
+             break
            }
-           const item = {
+           const textItem: Items = {
              content: data,
              pos,
```

**Chunk 6**
Lines added: 6, lines removed: 3

```diff
@@ -694,13 +696,16 @@
              type: actualType,
              eol,
+             sourceFile: r.sourceFile,
+             originalStart: r.originalStart,
+             sourceContent: r.sourceContent
            }
-           updateSourceMap(item)
-           curr.main.push(item)
+           updateSourceMap(textItem)
+           curr.main.push(textItem)
            break
          }
          case 'comments':
            trimStartLines()
            trimEndLines()
-           const item = {
+           const commentItem: Items = {
              content: data,
              pos,
```

**Chunk 7**
Lines added: 5, lines removed: 2

```diff
@@ -711,7 +716,10 @@
              type,
              eol,
+             sourceFile: r.sourceFile,
+             originalStart: r.originalStart,
+             sourceContent: r.sourceContent
            }
-           updateSourceMap(item)
-           curr.documentation.push(item)
+           updateSourceMap(commentItem)
+           curr.documentation.push(commentItem)
            break
        }
```

</details>

---

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ source maps –≤ –ø–∞—Ä—Å–µ—Ä–µ. –î–∞–≤–∞–π—Ç–µ –ø–æ–¥–≤–µ–¥–µ–º –∏—Ç–æ–≥–∏ —Ç–æ–≥–æ, —á—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏:

1. –í `fte.js-base`:
   - –î–æ–±–∞–≤–∏–ª–∏ —Ç–∏–ø—ã –¥–ª—è source maps
   - –°–æ–∑–¥–∞–ª–∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å source maps
   - –î–æ–±–∞–≤–∏–ª–∏ –∫–ª–∞—Å—Å—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —á—Ç–µ–Ω–∏—è source maps

2. –í `fte.js-parser`:
   - –û–±–Ω–æ–≤–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `ParserResult` –∏ `Items` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps
   - –î–æ–±–∞–≤–∏–ª–∏ –æ–ø—Ü–∏–∏ –¥–ª—è source maps –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–∞—Ä—Å–µ—Ä–∞
   - –û–±–Ω–æ–≤–∏–ª–∏ –º–µ—Ç–æ–¥ `block` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
   - –û–±–Ω–æ–≤–∏–ª–∏ –º–µ—Ç–æ–¥ `process` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ source maps

–¢–µ–ø–µ—Ä—å –ø–∞—Ä—Å–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏—è—Ö –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:
1. –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —à–∞–±–ª–æ–Ω–∞ –≤ –æ—Ç–ª–∞–¥—á–∏–∫–µ
2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–± –æ—à–∏–±–∫–∞—Ö
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–∞–∫ inline, —Ç–∞–∫ –∏ external source maps
4. –û–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–æ—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏–º–≤–æ–ª–æ–≤

–°–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `fte.js-templates` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞. –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —ç—Ç–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º?

---

_**User**_

–¥–∞

---

_**Assistant**_

–•–æ—Ä–æ—à–æ, –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º `fte.js-templates` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è source maps. –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

---

<details>
            <summary>Listed directory packages/fte.js-templates/src ‚Ä¢ **19** results</summary>
        
| Name |
|-------|
| üìÑ `MainTemplate.njs.ts` |
| üìÑ `index.ts` |
| üìÑ `MainTemplate.ts.njs.ts` |
| üìÑ `codeblock.njs.ts` |
| üìÑ `compilationError.njs.ts` |
| üìÑ `compiled.njs.ts` |
| üìÑ `es6module.njs.ts` |
| üìÑ `es6module.ts.njs.ts` |
| üìÑ `raw.njs.ts` |
| üìÑ `singlefile.es6.njs.ts` |
| üìÑ `singlefile.njs.ts` |
| üìÑ `singlefile.ts.njs.ts` |
| üìÑ `standalone.es6.njs.ts` |
| üìÑ `standalone.index.es6.njs.ts` |
| üìÑ `standalone.index.njs.ts` |
| üìÑ `standalone.index.ts.njs.ts` |
| üìÑ `standalone.njs.ts` |
| üìÑ `standalone.ts.njs.ts` |
| üìÑ `typedefinitions.njs.ts` |

</details>

---

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `fte.js-base` –≤ `fte.js-templates`:

---

```bash
pnpm add --filter fte.js-templates --workspace fte.js-base
```

```
‚ûú  fte.js-base git:(master) ‚úó pnpm add --filter fte.js-templates --workspace fte.js-base
.                                        | ‚ÄâWARN‚Äâ deprecated @types/source-map@0.5.7
‚ÄâWARN‚Äâ 1 deprecated subdependencies found: @npmcli/move-file@2.0.1
../..                                    | Progress: resolved 1110, reused 1093, downloaded 0, added 0, done
‚ÄâWARN‚Äâ Issues with peer dependencies found
packages/fte.js-parser
‚îî‚îÄ‚î¨ rollup-plugin-ts 3.2.0
  ‚îî‚îÄ‚î¨ ts-clone-node 2.0.4
    ‚îî‚îÄ‚îÄ ‚úï unmet peer typescript@"^3.x || ^4.x": found 5.2.0-dev.20230607

Done in 3.5s
‚ûú  fte.js-base git:(master) ‚úó
```

---

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ñ–∞–π–ª `codeblock.njs.ts`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–¥–∞:

---

Read file: packages/fte.js-templates/src/codeblock.njs.ts

---

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º —ç—Ç–æ—Ç —Ñ–∞–π–ª –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps:

---

<details><summary>Edit file: packages/fte.js-templates/src/codeblock.njs.ts</summary>

undefined

**Chunk 1**
Lines added: 44, lines removed: 1

```diff
@@ -1,10 +1,53 @@
  import { TemplateBase } from "fte.js-base";
+ import { TemplateSourceMapGenerator, SourceMapOptions } from "fte.js-base";
+ 
+ interface CodeBlockOptions {
+   escapeIt: (str: string) => string;
+   applyIndent: (str: string, indent: string) => string;
+   sourceMap?: boolean;
+   sourceFile?: string;
+   sourceRoot?: string;
+   inline?: boolean;
+ }
+ 
  export default {
      alias: [
          "codeblock.njs"
      ],
-     script: function(blockList, _content, partial, slot, options) {
+     script: function(blockList, _content, partial, slot, options: CodeBlockOptions) {
          var out: Array<string> = [];
          var textQuote = false;
+         const sourceMapGenerator = options.sourceMap ? new TemplateSourceMapGenerator({
+           file: options.sourceFile,
+           sourceRoot: options.sourceRoot,
+           inline: options.inline
+         }) : null;
+ 
+         let generatedLine = 1;
+         let generatedColumn = 0;
+ 
+         const addMapping = (block: any, content: string) => {
+           if (sourceMapGenerator && block.sourceFile && block.originalStart) {
+             sourceMapGenerator.addSegment({
+               generatedLine,
+               generatedColumn,
+               originalLine: block.originalStart.line,
+               originalColumn: block.originalStart.column,
+               source: block.sourceFile,
+               content: block.sourceContent,
+               name: block.type
+             });
+ 
+             // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ
+             const lines = content.split('\n');
+             if (lines.length > 1) {
+               generatedLine += lines.length - 1;
+               generatedColumn = lines[lines.length - 1].length;
+             } else {
+               generatedColumn += content.length;
+             }
+           }
+         };
+ 
          do {
              if (blockList.length == 0) break;
```

**Chunk 2**
Lines added: 6, lines removed: 2

```diff
@@ -41,11 +84,15 @@
                                  res = lasItem + " + ";
                              }
+                             let content: string;
                              if (!block.eol) {
-                                 res += JSON.stringify(cont);
+                                 content = JSON.stringify(cont);
+                                 res += content;
                              } else {
-                                 res += JSON.stringify(cont + "\n");
+                                 content = JSON.stringify(cont + "\n");
+                                 res += content;
                                  res += ");" + (last ? "" : "\n");
                                  textQuote = false;
                              }
+                             addMapping(block, content);
                              out.push(res);
                          }
```

**Chunk 3**
Lines added: 9, lines removed: 4

```diff
@@ -65,12 +112,17 @@
                                  lcont = "options.applyIndent(" + lcont + ", '" + block.indent + "')";
                              }
+                             let content: string;
                              if (block.start && block.end) {
-                                 res += "(" + lcont + ")";
+                                 content = "(" + lcont + ")";
+                                 res += content;
                              } else if (block.start) {
-                                 res += "(" + lcont;
+                                 content = "(" + lcont;
+                                 res += content;
                              } else if (block.end) {
-                                 res += lcont + ")";
+                                 content = lcont + ")";
+                                 res += content;
                              } else {
-                                 res += lcont;
+                                 content = lcont;
+                                 res += content;
                              }
                              if (!block.eol) {
```

**Chunk 4**
Lines added: 1, lines removed: undefined

```diff
@@ -88,4 +140,5 @@
                                  }
                              }
+                             addMapping(block, content);
                          }
                          break;
```

**Chunk 5**
Lines added: 9, lines removed: 4

```diff
@@ -105,12 +158,17 @@
                                  cont = "options.applyIndent(" + cont + ", '" + block.indent + "')";
                              }
+                             let content: string;
                              if (block.start && block.end) {
-                                 res += "(" + cont + ")";
+                                 content = "(" + cont + ")";
+                                 res += content;
                              } else if (block.start) {
-                                 res += "(" + cont;
+                                 content = "(" + cont;
+                                 res += content;
                              } else if (block.end) {
-                                 res += cont + ")";
+                                 content = cont + ")";
+                                 res += content;
                              } else {
-                                 res += cont;
+                                 content = cont;
+                                 res += content;
                              }
                              if (!block.eol) {
```

**Chunk 6**
Lines added: 1, lines removed: undefined

```diff
@@ -128,4 +186,5 @@
                                  }
                              }
+                             addMapping(block, content);
                          }
                          break;
```

**Chunk 7**
Lines added: 3, lines removed: 1

```diff
@@ -136,5 +195,7 @@
                              textQuote = false;
                          }
-                         out.push(cont + ((block.eol || next?.type != "code") ? "\n" : ""));
+                         const content = cont + ((block.eol || next?.type != "code") ? "\n" : "");
+                         addMapping(block, content);
+                         out.push(content);
                          break;
                  }
```

**Chunk 8**
Lines added: 16, lines removed: 1

```diff
@@ -145,5 +206,20 @@
              out.push(lasItem + ");");
          }
-         return out.join("");
+ 
+         let result = out.join("");
+ 
+         // –î–æ–±–∞–≤–ª—è–µ–º source map –µ—Å–ª–∏ –æ–Ω –≤–∫–ª—é—á–µ–Ω
+         if (sourceMapGenerator) {
+             if (options.inline) {
+                 result += "\n" + sourceMapGenerator.toInlineSourceMap();
+             } else {
+                 result += "\n//# sourceMappingURL=" + (options.sourceFile || "output.js") + ".map";
+             }
+         }
+ 
+         return {
+             code: result,
+             map: sourceMapGenerator?.toJSON()
+         };
      },
      compile: function(this: TemplateBase) {},
```

</details>

---

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `MainTemplate.njs.ts` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps:

---

Read file: packages/fte.js-templates/src/MainTemplate.njs.ts

---

–î–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º `MainTemplate.njs.ts` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ source maps:

---

<details><summary>Edit file: packages/fte.js-templates/src/MainTemplate.njs.ts</summary>

undefined

**Chunk 1**
Lines added: 15, lines removed: undefined

```diff
@@ -1,3 +1,18 @@
  import { TemplateBase } from "fte.js-base";
+ 
+ interface MainTemplateOptions {
+     applyIndent: (str: string, indent: string) => string;
+     applyDeindent: (str: string) => string;
+     sourceMap?: boolean;
+     sourceFile?: string;
+     sourceRoot?: string;
+     inline?: boolean;
+ }
+ 
+ interface MainTemplateResult {
+     code: string;
+     map?: any;
+ }
+ 
  export default {
      alias: [
```

**Chunk 2**
Lines added: 12, lines removed: 2

```diff
@@ -7,11 +22,21 @@
          "codeblock": "codeblock.njs"
      },
-     script: function(context, _content, partial, slot, options) {
+     script: function(context, _content, partial, slot, options: MainTemplateOptions): MainTemplateResult {
          function content<T>(blockName: string, ctx: T) {
              if (ctx === undefined || ctx === null) ctx = context;
              return _content(blockName, ctx, content, partial, slot);
          }
          var out: Array<string> = [];
-         const { directives  } = context;
+         const { directives } = context;
+ 
+         // –ü–µ—Ä–µ–¥–∞–µ–º –æ–ø—Ü–∏–∏ source map –≤ partial
+         const partialOptions = {
+             ...options,
+             sourceMap: options.sourceMap,
+             sourceFile: options.sourceFile,
+             sourceRoot: options.sourceRoot,
+             inline: options.inline
+         };
+ 
          out.push("{");
          if (directives.chunks) {
```

**Chunk 3**
Lines added: 1, lines removed: 1

```diff
@@ -29,5 +54,5 @@
          out.push("    var out = []\n");
          out.push((options.applyIndent(content("chunks-start", directives), "    ")) + "\n");
-         out.push((options.applyIndent(partial(context.main, "codeblock"), "    ")) + "\n");
+         out.push((options.applyIndent(partial(context.main, "codeblock", partialOptions), "    ")) + "\n");
          out.push((options.applyIndent(content("chunks-finish", directives), "    ")));
          if (directives.chunks) {
```

**Chunk 4**
Lines added: 1, lines removed: 1

```diff
@@ -86,5 +111,5 @@
                  out.push((options.applyIndent(content("maincontent", block.directives), "      ")) + "\n");
                  out.push("      var out = []\n");
-                 out.push((options.applyIndent(partial(block.main, "codeblock"), "      ")));
+                 out.push((options.applyIndent(partial(block.main, "codeblock", partialOptions), "      ")));
                  if (directives.chunks) {
                      out.push("\n");
```

**Chunk 5**
Lines added: 1, lines removed: 1

```diff
@@ -146,5 +171,5 @@
                  out.push((options.applyIndent(content("maincontent", slot.directives), "      ")) + "\n");
                  out.push("      var out = []\n");
-                 out.push((options.applyIndent(partial(slot.main, "codeblock"), "      ")));
+                 out.push((options.applyIndent(partial(slot.main, "codeblock", partialOptions), "      ")));
                  if (directives.chunks) {
                      out.push("\n");
```

**Chunk 6**
Lines added: 14, lines removed: 1

```diff
@@ -236,5 +261,18 @@
          out.push("  }\n");
          out.push("}");
-         return out.join("");
+ 
+         const result = out.join("");
+ 
+         // –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å source map –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ
+         if (mainMap) {
+             return {
+                 code: result,
+                 map: mainMap
+             };
+         }
+ 
+         return {
+             code: result
+         };
      },
      blocks: {
```

</details>

---

–î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞:

---

<details><summary>Edit file: packages/fte.js-templates/src/MainTemplate.njs.ts</summary>

undefined

**Chunk 1**
Lines added: 5, lines removed: undefined

```diff
@@ -38,4 +38,9 @@
              inline: options.inline
          };
+ 
+         // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ partial, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å source map
+         const mainResult = partial(context.main, "codeblock", partialOptions);
+         const mainCode = typeof mainResult === 'string' ? mainResult : mainResult.code;
+         const mainMap = typeof mainResult === 'string' ? undefined : mainResult.map;
  
          out.push("{");
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -54,5 +59,5 @@
          out.push("    var out = []\n");
          out.push((options.applyIndent(content("chunks-start", directives), "    ")) + "\n");
-         out.push((options.applyIndent(partial(context.main, "codeblock", partialOptions), "    ")) + "\n");
+         out.push((options.applyIndent(mainCode, "    ")) + "\n");
          out.push((options.applyIndent(content("chunks-finish", directives), "    ")));
          if (directives.chunks) {
```

</details>

---

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –±–ª–æ–∫–æ–≤ –∏ —Å–ª–æ—Ç–æ–≤ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º:

---

<details><summary>Edit file: packages/fte.js-templates/src/MainTemplate.njs.ts</summary>

undefined

**Chunk 1**
Lines added: 6, lines removed: 1

```diff
@@ -116,5 +116,10 @@
                  out.push((options.applyIndent(content("maincontent", block.directives), "      ")) + "\n");
                  out.push("      var out = []\n");
-                 out.push((options.applyIndent(partial(block.main, "codeblock", partialOptions), "      ")));
+ 
+                 // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ partial –¥–ª—è –±–ª–æ–∫–∞
+                 const blockResult = partial(block.main, "codeblock", partialOptions);
+                 const blockCode = typeof blockResult === 'string' ? blockResult : blockResult.code;
+                 out.push((options.applyIndent(blockCode, "      ")));
+ 
                  if (directives.chunks) {
                      out.push("\n");
```

**Chunk 2**
Lines added: 6, lines removed: 1

```diff
@@ -176,5 +181,10 @@
                  out.push((options.applyIndent(content("maincontent", slot.directives), "      ")) + "\n");
                  out.push("      var out = []\n");
-                 out.push((options.applyIndent(partial(slot.main, "codeblock", partialOptions), "      ")));
+ 
+                 // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ partial –¥–ª—è —Å–ª–æ—Ç–∞
+                 const slotResult = partial(slot.main, "codeblock", partialOptions);
+                 const slotCode = typeof slotResult === 'string' ? slotResult : slotResult.code;
+                 out.push((options.applyIndent(slotCode, "      ")));
+ 
                  if (directives.chunks) {
                      out.push("\n");
```

</details>

---

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `index.ts` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ source maps:

---

Read file: packages/fte.js-templates/src/index.ts

---



---

–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –¥—Ä—É–≥–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

---

<details><summary>Edit file: packages/fte.js-templates/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 17, lines removed: undefined

```diff
@@ -17,4 +17,21 @@
  import MainTemplate_ts_njs from "./MainTemplate.ts.njs";
  import MainTemplate_njs from "./MainTemplate.njs";
+ 
+ // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è source maps
+ export interface TemplateOptions {
+     escapeIt: (str: string) => string;
+     applyIndent: (str: string, indent: string) => string;
+     applyDeindent: (str: string) => string;
+     sourceMap?: boolean;
+     sourceFile?: string;
+     sourceRoot?: string;
+     inline?: boolean;
+ }
+ 
+ export interface TemplateResult {
+     code: string;
+     map?: any;
+ }
+ 
  const templates = {
      "typedefinitions.njs": typedefinitions_njs,
```

**Chunk 2**
Lines added: 1, lines removed: undefined

```diff
@@ -37,4 +54,5 @@
      "MainTemplate.njs": MainTemplate_njs
  };
+ 
  export default templates;
  
```

</details>

---

–Ø –≤–∏–∂—É, —á—Ç–æ –≤–æ–∑–Ω–∏–∫–ª–∏ –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º —Ç–∏–ø–æ–≤ –∏–∑ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π. –î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ, –¥–æ–±–∞–≤–∏–≤ —ç–∫—Å–ø–æ—Ä—Ç —ç—Ç–∏—Ö —Ç–∏–ø–æ–≤:

---

<details><summary>Edit file: packages/fte.js-templates/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -14,7 +14,7 @@
  import compiled_njs from "./compiled.njs";
  import compilationError_njs from "./compilationError.njs";
- import codeblock_njs from "./codeblock.njs";
+ import codeblock_njs, { CodeBlockOptions } from "./codeblock.njs";
  import MainTemplate_ts_njs from "./MainTemplate.ts.njs";
- import MainTemplate_njs from "./MainTemplate.njs";
+ import MainTemplate_njs, { MainTemplateOptions, MainTemplateResult } from "./MainTemplate.njs";
  
  // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è source maps
```

**Chunk 2**
Lines added: 4, lines removed: undefined

```diff
@@ -33,4 +33,8 @@
      map?: any;
  }
+ 
+ // –†–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∏–ø—ã
+ export { CodeBlockOptions } from "./codeblock.njs";
+ export { MainTemplateOptions, MainTemplateResult } from "./MainTemplate.njs";
  
  const templates = {
```

</details>

---

–ü–æ—Ö–æ–∂–µ, —á—Ç–æ —Ç–∏–ø—ã –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º —Ñ–∞–π–ª—ã –∏ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ç–∏–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è:

---

Read file: packages/fte.js-templates/src/codeblock.njs.ts

---

–¢–µ–ø–µ—Ä—å —è –≤–∏–∂—É –ø—Ä–æ–±–ª–µ–º—É. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `CodeBlockOptions` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –Ω–æ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è. –î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ –≤ –æ–±–æ–∏—Ö —Ñ–∞–π–ª–∞—Ö:

---

<details><summary>Edit file: packages/fte.js-templates/src/codeblock.njs.ts</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -2,5 +2,5 @@
  import { TemplateSourceMapGenerator, SourceMapOptions } from "fte.js-base";
  
- interface CodeBlockOptions {
+ export interface CodeBlockOptions {
    escapeIt: (str: string) => string;
    applyIndent: (str: string, indent: string) => string;
```

</details>

---

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è `MainTemplate.njs.ts`:

---

<details><summary>Edit file: packages/fte.js-templates/src/MainTemplate.njs.ts</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: 1

```diff
@@ -1,5 +1,6 @@
  import { TemplateBase } from "fte.js-base";
  
- interface MainTemplateOptions {
+ export interface MainTemplateOptions {
+     escapeIt: (str: string) => string;
      applyIndent: (str: string, indent: string) => string;
      applyDeindent: (str: string) => string;
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -10,5 +11,5 @@
  }
  
- interface MainTemplateResult {
+ export interface MainTemplateResult {
      code: string;
      map?: any;
```

</details>

---

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –¥–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º `index.ts`:

---

<details><summary>Edit file: packages/fte.js-templates/src/index.ts</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -14,7 +14,7 @@
  import compiled_njs from "./compiled.njs";
  import compilationError_njs from "./compilationError.njs";
- import codeblock_njs, { CodeBlockOptions } from "./codeblock.njs";
+ import codeblock_njs from "./codeblock.njs";
  import MainTemplate_ts_njs from "./MainTemplate.ts.njs";
- import MainTemplate_njs, { MainTemplateOptions, MainTemplateResult } from "./MainTemplate.njs";
+ import MainTemplate_njs from "./MainTemplate.njs";
  
  // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è source maps
```

**Chunk 2**
Lines added: 3, lines removed: 3

```diff
@@ -34,7 +34,7 @@
  }
  
- // –†–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∏–ø—ã
- export { CodeBlockOptions } from "./codeblock.njs";
- export { MainTemplateOptions, MainTemplateResult } from "./MainTemplate.njs";
+ // –†–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∏–ø—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π
+ export type { CodeBlockOptions } from "./codeblock.njs";
+ export type { MainTemplateOptions, MainTemplateResult } from "./MainTemplate.njs";
  
  const templates = {
```

</details>

---

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ç–∏–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –≤—Å–µ –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å–¥–µ–ª–∞–ª–∏:

1. –î–æ–±–∞–≤–∏–ª–∏ `export` –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º –≤ `codeblock.njs.ts` –∏ `MainTemplate.njs.ts`
2. –û–±–Ω–æ–≤–∏–ª–∏ –∏–º–ø–æ—Ä—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç—ã –≤ `index.ts`, –∏—Å–ø–æ–ª—å–∑—É—è `export type` –¥–ª—è —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç–∞ —Ç–∏–ø–æ–≤
3. –°–æ—Ö—Ä–∞–Ω–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç source maps –∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∏–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è. –•–æ—Ç–∏—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ–±—ã —è —á—Ç–æ-—Ç–æ –µ—â–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –∏–ª–∏ –æ–±—ä—è—Å–Ω–∏–ª?

---

