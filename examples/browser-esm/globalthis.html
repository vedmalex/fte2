<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>FTE.js ESM Browser Example (globalThis)</title>
  </head>
  <body>
    <div id="app"></div>
    <script>
      // Minimal global shims (if needed by templates)
      window.globalThis = window.globalThis || window;
    </script>
    <script type="module">
      import templates from '../../packages/fte.js-templates/dist/index.js';
      import { TemplateFactoryStandalone as Factory } from '../../packages/fte.js-standalone/dist/TemplateFactoryStandalone.js';

      // Build a simple runtime template in-place using compiled.njs
      const t = {
        name: 'hello.njs',
        directives: { context: 'context', requireAs: [], require: [], blocks: {}, slots: {} },
        blocks: {},
        slots: {},
        main: [
          { type: 'text', content: 'Hello ', eol: false },
          { type: 'expression', content: 'name', start: true, end: true, eol: true },
        ],
      };

      const compiled = templates['compiled.njs'].script(
        t,
        null,
        (obj, name) => templates[name],
        null,
        { applyIndent: s => s, applyDeindent: s => s, escapeIt: s => s }
      );

      const helloTemplate = eval('(' + (typeof compiled === 'string' ? compiled : compiled.code) + ')');
      const F = new Factory({ 'hello.njs': helloTemplate });
      const html = F.run({ name: 'world' }, 'hello.njs');
      document.getElementById('app').textContent = html;
    </script>
  </body>
</html>
